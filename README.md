# 网盘搜索插件

一个用于AstrBot的网盘资源搜索插件，支持多平台网盘资源搜索。**支持在管理界面安全配置Token等敏感信息**。

## 🌟 功能特色

- 🔍 支持多关键词搜索
- 📄 分页浏览搜索结果
- ⏰ 时间筛选（一周、一月、三月、一年内）
- 💾 平台筛选（百度、阿里、夸克、迅雷网盘）
- 🎯 精确搜索模式
- ⚡ 请求频率限制防刷屏
- 🔒 **安全的配置管理** - Token等敏感信息不写在代码中
- 🛡️ 权限控制 - 支持群组白名单和管理员设置
- 📊 使用统计功能

## 🚀 安装方法

### 方法1：手动安装
1. 将插件文件夹放入 `data/plugins/` 目录
2. 重启AstrBot或在管理面板重载插件

### 方法2：Git克隆
```bash
cd AstrBot/data/plugins/
git clone [你的插件仓库地址] netdisk_search
```

## ⚙️ 配置说明

### 初次使用配置
插件首次运行时会自动创建 `config.json` 配置文件。管理员需要通过聊天命令进行配置：

### 配置命令（仅管理员可用）

#### 查看当前配置
```
/网盘配置
```

#### 设置API Token（必须）
```
/网盘配置 token 你的API_Token
```

#### 设置其他参数
```
/网盘配置 max_results 15        # 设置每页最大结果数（1-50）
/网盘配置 interval 5            # 设置请求间隔秒数（1-60）
/网盘配置 add_group 群号        # 添加允许使用的群组
/网盘配置 add_admin 用户ID      # 添加管理员
```

### 配置项说明
- **token**: API认证令牌（必须配置）
- **max_results**: 每页显示结果数量（1-50，默认10）
- **request_interval**: 用户请求间隔秒数（1-60，默认3）
- **enabled_groups**: 允许使用插件的群组ID列表（空=允许所有）
- **admin_users**: 管理员用户ID列表

## 📝 使用方法

### 基础搜索
```
/搜索 Python教程
/搜索 电影合集
```

### 高级搜索
```
/搜索 关键词 [页码] [参数]
```

#### 参数说明：
- **页码**：1, 2, 3... (默认第1页)
- **时间范围**：
  - `week` 或 `一周` - 一周内
  - `month` 或 `一月` - 一个月内
  - `three_month` 或 `三月` - 三个月内
  - `year` 或 `一年` - 一年内
- **资源类型**：
  - `BDY` 或 `百度` - 百度网盘
  - `ALY` 或 `阿里` - 阿里云盘
  - `QUARK` 或 `夸克` - 夸克网盘
  - `XUNLEI` 或 `迅雷` - 迅雷云盘
- **搜索模式**：
  - `exact` 或 `精确` - 精确匹配

### 使用示例

```
/搜索 Python教程                    # 基础搜索
/搜索 电影 2                       # 搜索第2页
/搜索 小说 week                    # 搜索一周内的小说
/搜索 纪录片 BDY                   # 搜索百度网盘的纪录片
/搜索 课程 exact                   # 精确搜索课程
/搜索 电影 2 month ALY exact       # 组合搜索：第2页，一个月内，阿里云盘，精确匹配
/搜索 资源 阿里 精确               # 中文参数搜索
```

### 其他命令

```
/网盘帮助      # 显示帮助信息
/网盘配置      # 查看/设置配置（仅管理员）
```

## 🔒 安全特性

### Token安全
- ✅ **Token不暴露在代码中** - 通过配置命令安全设置
- ✅ **配置文件本地存储** - 敏感信息只存在服务器本地
- ✅ **权限验证** - 只有管理员可以配置Token

### 权限控制
- 🛡️ **群组白名单** - 可限制特定群组使用
- 👑 **管理员系统** - 分级权限管理
- ⏰ **频率限制** - 防止恶意刷屏

## 📁 文件结构

```
data/plugins/netdisk_search/
├── main.py           # 主插件文件
├── metadata.yaml     # 插件元数据
├── config.json       # 配置文件（自动生成）
├── requirements.txt  # 依赖文件
└── README.md        # 说明文档
```

## 🔧 首次部署步骤

1. **安装插件**：将文件放入 `data/plugins/netdisk_search/`
2. **重启AstrBot**：让插件加载
3. **配置Token**：发送 `/网盘配置 token 你的API令牌`
4. **设置管理员**：发送 `/网盘配置 add_admin 你的用户ID`
5. **测试搜索**：发送 `/搜索 测试`

## 🔍 API说明

插件调用的API接口：
- **URL**: `https://so.yuneu.com/open/search/disk`
- **方法**: POST
- **格式**: JSON

### 请求参数
```json
{
  "q": "搜索词",
  "page": 1,
  "size": 10,
  "time": "week",
  "type": "BDY",
  "exact": false
}
```

## ⚠️ 注意事项

1. **首次使用**：必须先配置API Token才能搜索
2. **管理员权限**：需要先设置管理员才能使用配置功能
3. **群组限制**：如果设置了群组白名单，只有指定群组可以使用
4. **频率限制**：默认用户请求间隔3秒，可通过配置调整

## 🛠️ 故障排除

### 常见问题

1. **提示"未配置API Token"**
   - 解决：发送 `/网盘配置 token 你的令牌`

2. **提示"您没有权限使用此插件"**
   - 解决：联系管理员添加你到群组白名单或管理员列表

3. **搜索无结果**
   - 检查关键词是否正确
   - 尝试更换搜索参数
   - 确认API服务是否正常

4. **插件不响应**
   - 确认插件已正确安装
   - 检查依赖是否安装完整
   - 重载插件或重启AstrBot

5. **配置命令无效**
   - 确认你是管理员用户
   - 检查命令格式是否正确
   - 查看AstrBot日志中的错误信息

### 依赖问题

如果遇到依赖问题，请手动安装：
```bash
pip install httpx>=0.24.0
```

## 🔄 版本更新

### v1.0.0
- ✅ 初始版本发布
- ✅ 支持基础搜索功能
- ✅ 支持高级参数搜索
- ✅ 支持中英文参数
- ✅ 添加频率限制和错误处理
- ✅ **新增安全配置管理**
- ✅ **支持权限控制**
- ✅ **管理员配置系统**

## 📋 支持平台

- ✅ QQ频道
- ✅ QQ群
- ✅ Telegram
- ✅ 微信
- ✅ 飞书

## 👨‍💻 开发者信息

- **作者**: YourName
- **版本**: 1.0.0
- **许可**: MIT
- **仓库**: [GitHub链接]

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个插件！

### 开发环境搭建
```bash
git clone [仓库地址]
cd netdisk_search_plugin
pip install -r requirements.txt
```

### 提交代码
1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/新功能`)
3. 提交更改 (`git commit -am '添加新功能'`)
4. 推送到分支 (`git push origin feature/新功能`)
5. 创建Pull Request

## 📄 许可证

MIT License - 详见 LICENSE 文件

## 🙏 致谢

感谢 [AstrBot](https://github.com/Soulter/AstrBot) 提供的优秀机器人框架！

---

## 📞 联系方式

如有问题或建议，请通过以下方式联系：
- GitHub Issues: [仓库地址/issues]
- Email: [你的邮箱]

**⚠️ 重要提醒**: 请不要在公开场合分享你的API Token！
